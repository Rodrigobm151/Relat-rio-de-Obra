<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Squad Geotecnia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --azul-fundo: #3CB5E5;
            --branco: #FFFFFF;
        }

        @font-face {
            font-family: 'ValeSans';
            src: url('./assets/fonts/ValeSans-Italic.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'ValeSans', sans-serif; }
        
        body, html { 
            height: 100%; 
            background-color: var(--azul-fundo);
            color: white;
            overflow: hidden;
        }

        .main-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        /* VÍDEO NO TOPO COM CROP */
        .video-container {
            position: relative;
            width: 100%;
            height: 40vh;
            overflow: hidden;
        }

        .header-video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Faz o crop automático */
        }

        /* EFEITO DE FADE PARA O AZUL */
        .video-container::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 60%;
            background: linear-gradient(to bottom, transparent, var(--azul-fundo));
        }

        /* CONTEÚDO CENTRAL */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 0 30px;
            z-index: 10;
            margin-top: -40px; /* Sobe o logo para cima do fade */
        }

        .squad-logo { width: 120px; height: auto; margin-bottom: 10px; }

        .app-title { font-size: 2.2rem; font-weight: normal; margin-bottom: 5px; }

        .glitch-text { 
            font-size: 1.1rem; 
            min-height: 1.5rem;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .vale-logo { width: 100px; margin-bottom: 40px; }

        /* INPUTS ESTILO POWERPOINT */
        #fiscalSelect {
            width: 100%;
            max-width: 280px;
            height: 35px;
            border: none;
            border-radius: 2px;
            padding: 0 10px;
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 20px;
            color: #555;
        }

        .btn-entrar {
            width: 100%;
            max-width: 180px;
            height: 45px;
            background: #3498db; /* Azul um pouco mais escuro para o botão */
            color: white;
            border: 1px solid #2980b9;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            font-style: italic;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2);
            transition: transform 0.1s;
        }

        .btn-entrar:active { transform: scale(0.98); }
        .btn-entrar:disabled { opacity: 0.6; cursor: not-allowed; }

        /* FOOTER */
        footer {
            padding-bottom: 20px;
            font-size: 0.8rem;
        }

        .reta-logo { width: 120px; margin-top: 5px; filter: brightness(0) invert(1); }

    </style>
</head>
<body>

    <main class="main-container">
        <section class="video-container">
            <video class="header-video" autoplay muted loop playsinline>
                <source src="./assets/video/background.mp4" type="video/mp4">
            </video>
        </section>

        <section class="content">
            <img src="./assets/imagens/squad-logo.png" class="squad-logo" alt="Logo Squad">
            <h1 class="app-title">Squad Geotecnia</h1>
            <div id="glitch-target" class="glitch-text">Obras geotecnicas</div>

            <img src="./assets/imagens/vale-logo.png" class="vale-logo" alt="Vale">

            <select id="fiscalSelect">
                <option value="">Carregando usuários...</option>
            </select>

            <button class="btn-entrar" id="btnEntrar" onclick="entrarSistema()" disabled>
                Entrar
            </button>
        </section>

        <footer>
            <p>developed by</p>
            <img src="./assets/imagens/reta-logo.png" class="reta-logo" alt="Reta Engenharia">
        </footer>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDm7jQbxnJ2aq6Hf-e3ufkoMi2yc6PjIgE",
            authDomain: "relatorio-obra-geotecnia.firebaseapp.com",
            databaseURL: "https://relatorio-obra-geotecnia-default-rtdb.firebaseio.com",
            projectId: "relatorio-obra-geotecnia",
            storageBucket: "relatorio-obra-geotecnia.firebasestorage.app",
            messagingSenderId: "765646735604",
            appId: "1:765646735604:web:59424d5353813939e976a1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Busca usuários do Firebase
        async function carregarUsuarios() {
            const select = document.getElementById('fiscalSelect');
            try {
                // Ajuste o caminho 'usuarios' para o nó correto do seu banco
                const snapshot = await get(ref(db, 'usuarios')); 
                select.innerHTML = '<option value="">Selecione usuário</option>';
                
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const user = child.val();
                        const option = document.createElement('option');
                        option.value = child.key;
                        option.textContent = user.nome || child.key;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error("Erro ao carregar:", error);
                select.innerHTML = '<option value="">Erro ao carregar</option>';
            }
        }

        carregarUsuarios();
        
        // Habilita botão ao selecionar
        document.getElementById('fiscalSelect').addEventListener('change', (e) => {
            document.getElementById('btnEntrar').disabled = !e.target.value;
        });

        window.entrarSistema = () => {
            const select = document.getElementById('fiscalSelect');
            localStorage.setItem('currentFiscal', select.value);
            localStorage.setItem('currentFiscalNome', select.options[select.selectedIndex].text);
            window.location.href = 'fiscal.html';
        };
    </script>

    <script>
        // Lógica do Efeito de Texto Rotativo (Glitch)
        const phrases = ["Obras geotecnicas", "Somons bons", "Precisão digital"];
        let i = 0;
        const target = document.getElementById("glitch-target");

        setInterval(() => {
            i = (i + 1) % phrases.length;
            target.style.opacity = 0;
            setTimeout(() => {
                target.textContent = phrases[i];
                target.style.opacity = 1;
            }, 500);
        }, 3500);
    </script>
</body>
</html>
