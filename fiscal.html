<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>RDC - Área do Fiscal</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>

/* ================= VARIÁVEIS ================= */

:root {

--azul-vale: #3CB5E5;
--verde-vale: #007E79;
--cinza-texto: #555;
--cinza-medio: #747678;
--cinza-claro: #BCBEC0;
--cinza-mais-claro: #E6E7E8;
--laranja: #ff9800;
--vermelho: #e74c3c;
--fundo: #f5f7fa;
--branco: #fff;

}

/* ================= RESET ================= */

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:'Inter',sans-serif;
}

body{
background:var(--fundo);
color:var(--cinza-texto);
}

/* ================= HEADER ================= */

.header{
background:var(--azul-vale);
color:white;
padding:1rem;
position:sticky;
top:0;
z-index:100;
}

.header-content{
max-width:800px;
margin:auto;
display:flex;
justify-content:space-between;
align-items:center;
}

.btn-sair{
background:rgba(255,255,255,.2);
border:none;
color:white;
padding:.5rem 1rem;
border-radius:20px;
cursor:pointer;
}

/* ================= CONTAINER ================= */

.container{
max-width:800px;
margin:auto;
padding:1rem;
padding-bottom:120px;
}

/* ================= CARD ================= */

.card{
background:white;
border-radius:16px;
padding:1.5rem;
margin-bottom:1rem;
box-shadow:0 2px 8px rgba(0,0,0,.05);
}

.card-title{
color:var(--azul-vale);
margin-bottom:1rem;
}

/* ================= EQUIPAMENTOS ================= */

.equip-list{
background:white;
border-radius:12px;
overflow:hidden;
box-shadow:0 2px 8px rgba(0,0,0,.05);
}

.equip-item{
padding:1rem;
border-bottom:1px solid var(--cinza-mais-claro);
}

.equip-item:last-child{
border-bottom:none;
}

.equip-detail{
background:#f9f9f9;
padding:0;
max-height:0;
overflow:hidden;
transition:.3s;
}

.equip-detail.open{
padding:1rem;
max-height:600px;
}

/* ================= FORM ================= */

.form-group{
margin-bottom:1rem;
}

.form-label{
font-size:.9rem;
display:block;
margin-bottom:.3rem;
}

.form-input,
.form-textarea{
width:100%;
padding:.7rem;
border:2px solid var(--cinza-mais-claro);
border-radius:8px;
}

.btn-salvar-item{
background:var(--verde-vale);
color:white;
border:none;
padding:.8rem;
border-radius:8px;
width:100%;
cursor:pointer;
font-weight:600;
}

/* ================= TOAST ================= */

.toast{
position:fixed;
top:90px;
left:50%;
transform:translateX(-50%) translateY(-100px);
background:#333;
color:white;
padding:1rem 2rem;
border-radius:30px;
opacity:0;
transition:.3s;
z-index:999;
}

.toast.show{
opacity:1;
transform:translateX(-50%) translateY(0);
}

</style>
</head>

<body>

<!-- ================= HEADER ================= -->

<header class="header">

<div class="header-content">

<div>
<h3 id="headerTitle">Minhas Obras</h3>
<small id="headerSubtitle">Selecione uma obra</small>
</div>

<button class="btn-sair" onclick="sair()">
<i class="fas fa-sign-out-alt"></i> Sair
</button>

</div>

</header>


<!-- ================= CONTAINER ================= -->

<div class="container">


<!-- ================= PAINEL EQUIP ================= -->

<div id="formPanel">

<div class="card">

<h3 class="card-title">
<i class="fas fa-truck"></i> Equipamentos
</h3>

<p style="font-size:.85rem;color:var(--cinza-medio)">
Clique para informar quantidade real
</p>

</div>


<div id="equipamentosContainer">

<div style="text-align:center;padding:2rem">
Carregando...
</div>

</div>

</div>

</div>


<!-- ================= TOAST ================= -->

<div class="toast" id="toast"></div>


<!-- ================= FIREBASE ================= -->

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {

apiKey: "AIzaSyDm7jQbxnJ2aq6Hf-e3ufkoMi2yc6PjIgE",
authDomain: "relatorio-obra-geotecnia.firebaseapp.com",
databaseURL: "https://relatorio-obra-geotecnia-default-rtdb.firebaseio.com",
projectId: "relatorio-obra-geotecnia"

};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.db = db;
window.dbRef = ref;
window.dbGet = get;
window.dbSet = set;

</script>


<!-- ================= SCRIPT ================= -->

<script>

/* ================= ESTADO ================= */

let equipamentosContrato = [];
let currentRDC = { dados:{ equipamentos:{} } };


/* ================= INIT ================= */

document.addEventListener('DOMContentLoaded',()=>{

carregarEquipamentos("2026-02-16");

});


/* ================= CARREGAR ================= */

async function carregarEquipamentos(dataKey){

const container = document.getElementById('equipamentosContainer');

try{

// Simulação — troque pelo seu Firebase
equipamentosContrato = [

{id:"1",nome:"Escavadeira",previsto:5},
{id:"2",nome:"Trator",previsto:3},
{id:"3",nome:"Caminhão",previsto:4}

];

renderEquipamentos();

}
catch(e){

container.innerHTML="Erro ao carregar";

}

}


/* ================= RENDER ================= */

function renderEquipamentos(){

const container = document.getElementById('equipamentosContainer');

let html = '<div class="equip-list">';

equipamentosContrato.forEach((eq,index)=>{

const dados = currentRDC.dados.equipamentos[eq.id] || {};

const real = dados.real!==undefined ? dados.real : '-';
const manut = dados.manutencao || 0;

let status = '⏳';

if(dados.real!==undefined){

if(manut>0) status='⚠️';
else if(real==eq.previsto) status='✅';
else status='✏️';

}

html+=`

<div class="equip-item">

<div onclick="toggleEquip(${index})"
style="display:flex;justify-content:space-between;align-items:center">

<div>

<strong>${eq.nome}</strong><br>

<small style="color:var(--cinza-medio)">
Prev: ${eq.previsto} | Real: ${real}
${manut>0?` | Manut: ${manut}`:''}
</small>

</div>

<div style="font-size:20px">${status}</div>

</div>


<div class="equip-detail" id="equip-detail-${index}">


<div class="form-group">

<label class="form-label">Quantidade real</label>

<input type="number"
id="equip-real-${index}"
value="${dados.real!==undefined?dados.real:eq.previsto}"
class="form-input">

</div>


<div class="form-group">

<label class="form-label">Em manutenção</label>

<input type="number"
id="equip-manut-${index}"
value="${manut}"
class="form-input">

</div>


<div class="form-group">

<label class="form-label">Observações</label>

<textarea id="equip-obs-${index}"
class="form-textarea">${dados.obs||''}</textarea>

</div>


<button class="btn-salvar-item"
onclick="salvarEquipamento('${eq.id}',${index});event.stopPropagation()">

<i class="fas fa-check"></i> Confirmar

</button>

</div>

</div>

`;

});

html+='</div>';

container.innerHTML = html;

}


/* ================= TOGGLE ================= */

function toggleEquip(index){

const detail = document.getElementById(`equip-detail-${index}`);

detail.classList.toggle('open');

}


/* ================= SALVAR ================= */

function salvarEquipamento(id,index){

const real = parseInt(document.getElementById(`equip-real-${index}`).value)||0;

const manut = parseInt(document.getElementById(`equip-manut-${index}`).value)||0;

const obs = document.getElementById(`equip-obs-${index}`).value;


if(manut>real){

showToast("Manutenção maior que real");

return;

}


currentRDC.dados.equipamentos[id]={

real,
manutencao:manut,
obs,
data:new Date().toISOString()

};


renderEquipamentos();

showToast("Atualizado!");

}


/* ================= TOAST ================= */

function showToast(msg){

const t = document.getElementById('toast');

t.textContent = msg;

t.classList.add('show');

setTimeout(()=>t.classList.remove('show'),2500);

}


/* ================= SAIR ================= */

function sair(){

alert("Logout aqui");

}

</script>

</body>
</html>
